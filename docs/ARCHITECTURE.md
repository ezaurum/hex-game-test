# 아키텍처 문서

## 📐 전체 시스템 구조

이 프로젝트는 모듈화된 구조로 설계되어 있으며, 각 모듈은 특정 책임을 가지고 있습니다.

```
┌─────────────────────────────────────────────────────────┐
│                      index.html                          │
│                         ↓                                │
│                      main.js                             │
│                    (게임 진입점)                          │
├─────────────────────────┬───────────────────────────────┤
│         Core           │            Systems             │
│   ┌─────────────┐     │      ┌─────────────┐          │
│   │ constants   │     │      │ gridSystem  │          │
│   │ gameState   │     │      │ combatSystem│          │
│   │ sceneSetup  │     │      │ movementSys │          │
│   └─────────────┘     │      │ aiSystem    │          │
│                        │      └─────────────┘          │
├────────────────────────┼───────────────────────────────┤
│      Entities         │         Controls               │
│   ┌─────────────┐     │      ┌─────────────┐          │
│   │  HexTile    │     │      │cameraControl│          │
│   │  Character  │     │      │inputHandler │          │
│   └─────────────┘     │      └─────────────┘          │
├────────────────────────┼───────────────────────────────┤
│         UI            │          Utils                 │
│   ┌─────────────┐     │      ┌─────────────┐          │
│   │ combatLog   │     │      │  hexMath    │          │
│   │ fpsCounter  │     │      │  animation  │          │
│   └─────────────┘     │      └─────────────┘          │
└────────────────────────┴───────────────────────────────┘
```

## 🏗️ 모듈별 상세 설명

### Core 모듈

#### constants.js
- **역할**: 게임 전체에서 사용되는 상수 정의
- **주요 내용**:
  - 게임 설정값 (그리드 크기, 이동 범위 등)
  - 색상 팔레트
  - 애니메이션 설정
  - 열거형 상수

#### gameState.js
- **역할**: 전역 게임 상태 관리 (싱글톤 패턴)
- **주요 기능**:
  - 현재 턴 관리
  - 선택된 캐릭터 추적
  - 게임 진행 상태 (승리/패배)
  - 캐릭터 목록 관리

#### sceneSetup.js
- **역할**: Three.js 씬, 카메라, 렌더러 초기화
- **주요 기능**:
  - 3D 환경 설정
  - 조명 설정
  - 렌더링 최적화

### Entity 모듈

#### HexTile.js
- **역할**: 육각형 타일 엔티티
- **주요 기능**:
  - 큐브 좌표계 구현
  - 3D 메시 생성 및 관리
  - 타일 상태 (하이라이트, 점유 등)

#### Character.js
- **역할**: 플레이어/적 캐릭터 엔티티
- **주요 기능**:
  - 체력 및 공격력 관리
  - 이동 및 공격 애니메이션
  - 3D 모델 및 UI (체력바)

### System 모듈

#### gridSystem.js
- **역할**: 육각형 그리드 생성 및 관리
- **주요 기능**:
  - 그리드 생성
  - 이웃 타일 찾기
  - 경로 찾기 (A* 알고리즘)
  - 범위 계산

#### combatSystem.js
- **역할**: 전투 로직 처리
- **주요 기능**:
  - 공격 실행 및 데미지 계산
  - 전투 로그 생성
  - 게임 종료 조건 확인

#### movementSystem.js
- **역할**: 캐릭터 이동 관리
- **주요 기능**:
  - 이동 가능 영역 표시
  - 경로 미리보기
  - 이동 애니메이션

#### aiSystem.js
- **역할**: 적 AI 행동 결정
- **주요 기능**:
  - 최적 행동 선택
  - 타겟 우선순위 결정
  - 난이도 조절

### Control 모듈

#### cameraControls.js
- **역할**: 카메라 조작
- **주요 기능**:
  - 팬, 회전, 줌
  - 구면 좌표계 사용
  - 부드러운 카메라 이동

#### inputHandler.js
- **역할**: 사용자 입력 처리
- **주요 기능**:
  - 마우스/키보드 이벤트
  - 레이캐스팅
  - 타일/캐릭터 선택

### UI 모듈

#### combatLog.js
- **역할**: 전투 로그 표시
- **주요 기능**:
  - 실시간 로그 업데이트
  - 로그 타입별 색상 구분
  - 자동 스크롤

#### fpsCounter.js
- **역할**: 성능 모니터링
- **주요 기능**:
  - FPS 측정 및 표시
  - 성능 통계
  - 상세/간단 모드 전환

### Utility 모듈

#### hexMath.js
- **역할**: 육각형 관련 수학 함수
- **주요 기능**:
  - 좌표 변환
  - 거리 계산
  - 기하학적 연산

#### animation.js
- **역할**: 애니메이션 유틸리티
- **주요 기능**:
  - 이징 함수
  - 트윈 애니메이션
  - 파티클 효과

## 🔄 데이터 흐름

### 게임 초기화 흐름
```
main.js
  ↓
sceneSetup.init() → Three.js 환경 구성
  ↓
gridSystem.createGrid() → 육각형 그리드 생성
  ↓
Character 생성 → 캐릭터 배치
  ↓
UI 초기화 → combatLog, fpsCounter
  ↓
게임 루프 시작
```

### 턴 진행 흐름
```
플레이어 입력
  ↓
inputHandler → 클릭/키보드 이벤트
  ↓
movementSystem/combatSystem → 행동 실행
  ↓
gameState 업데이트
  ↓
적 턴 시작 → aiSystem
  ↓
적 행동 실행
  ↓
턴 종료 → 다음 턴
```

## 🎮 게임 루프

```javascript
// 메인 게임 루프 (60 FPS)
function animate() {
    requestAnimationFrame(animate);
    
    // 1. FPS 업데이트
    fpsCounter.update();
    
    // 2. 카메라 업데이트
    cameraControls.updateCameraPosition();
    
    // 3. 애니메이션 업데이트 (필요시)
    // updateAnimations();
    
    // 4. 렌더링
    sceneSetup.render();
}
```

## 🔌 확장 포인트

### 새로운 캐릭터 타입 추가
1. `Character.js`를 상속하여 새 클래스 생성
2. `constants.js`에 새 타입 추가
3. `main.js`의 `createCharacters()`에서 생성

### 새로운 타일 효과 추가
1. `HexTile.js`에 새 상태 추가
2. `gridSystem.js`에 효과 로직 구현
3. `inputHandler.js`에서 상호작용 처리

### 새로운 AI 행동 패턴
1. `aiSystem.js`에 새 행동 함수 추가
2. `determineAction()`에서 조건 추가
3. 난이도에 따른 조정 구현

## 🚀 성능 최적화

### 렌더링 최적화
- 레이어 시스템 사용 (타일, 테두리, 캐릭터)
- 프러스텀 컬링 자동 적용
- 그림자맵 해상도 조절

### 메모리 관리
- 리소스 정리 함수 (`dispose()`)
- 이벤트 리스너 적절한 제거
- 불필요한 객체 생성 최소화

### 계산 최적화
- A* 경로찾기 최적화
- 타일 맵을 이용한 빠른 검색
- 불필요한 업데이트 방지